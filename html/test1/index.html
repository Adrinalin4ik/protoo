<!doctype html>
<html>

<head>
	<meta charset='utf-8'>
	<title>ws.ibc test1</title>
	<script>
		function generateUUID() {
			var i, r;
			var token = '';
			var size = 10;
			var base = 32;

			for( i=0; i < size; i++ ) {
				r = Math.random() * base|0;
				token += r.toString(base);
			}
			return token;
		}

		function connect(username, uuid) {
			console.log('username:%s | uuid:%s', username, uuid);

			var ws = new WebSocket('wss://local.protoo.org:10443?username=' + username + '&uuid=' + uuid, ['qwe', 'protoo', 'foo']);

			ws.onopen = function() {
				console.log('WebSocket onopen! | protocol: %s', ws.protocol);
			};

			ws.onerror = function() {
				console.error('WebSocket onerror!');
			};

			ws.onclose = function(e) {
				console.error('WebSocket onclose! [code:%d | reason:%s | wasClean:%s]', e.code, e.reason, e.wasClean);
			};

			ws.onmessage = function(e) {
				console.log('WebSocket onmessage: %s', e.data);
			};

			window.ws = ws;
		}


		var username = 'ibc';
		var uuid = generateUUID();

		function test1() {
			connect(username, uuid);
		}

		function test2() {
			setInterval(function() {
				test1();
			}, 50);
		}

		function test3() {
			setInterval(function() {
				connect(username, generateUUID());
			}, 50);
		}
	</script>
</head>

<body onload='test1()'>
</body>

</html>
